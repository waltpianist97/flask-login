{% extends "base.html" %}

{% block content %}
<div class="main">
    <center>
        <form class="form-container" method="post">
            {{ form.hidden_tag()}}
            <div class="box">
                <table>
                    <caption>
                        <h1 style="color: red;">Aggiungi un giro</h1>
                    </caption>

                    <tr>
                        <td>{{ form.tripname.label }}</td>
                        <td>{{ form.tripname() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.speed.label }}</td>
                        <td>{{ form.speed() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.distance.label }}</td>
                        <td>{{ form.distance() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.elevation.label }}</td>
                        <td>{{ form.elevation() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.n_of_partecipants.label }}</td>
                        <td>{{ form.n_of_partecipants() }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.prestige.label }}</td>
                        <td>
                            <div class="prestige-label-container">
                                {% for subfield in form.prestige %}
                                <label class="prestige-label">
                                    {{ subfield }}
                                    <span>{{ subfield.label() }}</span>
                                </label><br>
                                {% endfor %}
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>{{ form.description.label }}</td>
                        <td>{{ form.description(size=20, rows=5) }}</td>
                    </tr>
                    <tr>
                        <td>{{ form.n_of_placements.label }}</td>
                        <td>{{ form.n_of_placements() }}
                            <div id="placement-entries">

                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="2" style="text-align: center;">{{ form.submit_save }}</td>
                    </tr>
                </table>

            </div>
        </form>
    </center>
    <div class="left-sidebar"></div>
    <div class="right-sidebar"></div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var numPlacementsField = document.getElementById("n_of_placements");
        var placementEntriesContainer = document.getElementById("placement-entries");

        // Add event listener to numPlacementsField
        numPlacementsField.addEventListener("input", function () {
            var numPlacements = parseInt(numPlacementsField.value) || 0;

            // Clear previous placement entries
            placementEntriesContainer.innerHTML = "";

            // Generate new placement entries
            for (var i = 0; i < numPlacements; i++) {
                var label = document.createElement("label");
                label.textContent = "Placement " + (i + 1) + " ";

                var select = document.createElement("select");
                select.name = "placement-" + i;

                // Add options with values 1 to 10
                for (var j = 1; j <= 10; j++) {
                    var option = document.createElement("option");
                    option.value = j;
                    option.text = j + "\u00BA";
                    select.appendChild(option);
                }

                var deleteButton = document.createElement("button");
                deleteButton.textContent = "Elimina";
                deleteButton.className = "delete-button";

                deleteButton.addEventListener("click", function () {
                    this.parentNode.remove(); // Remove the parent div when delete button is clicked
                    updateNumPlacements(); // Update the n_of_placements field
                });

                var div = document.createElement("div");
                div.appendChild(label);
                div.appendChild(select);
                div.appendChild(deleteButton);

                placementEntriesContainer.appendChild(div);
            }
        });

        // Update the n_of_placements field
        function updateNumPlacements() {
            var placementEntries = placementEntriesContainer.getElementsByTagName("div");
            numPlacementsField.value = placementEntries.length;
        }

        // Add event listener to delete buttons
        placementEntriesContainer.addEventListener("click", function (event) {
            if (event.target.classList.contains("delete-button")) {
                event.target.parentNode.remove(); // Remove the parent div when delete button is clicked
                updateNumPlacements(); // Update the n_of_placements field
            }
        });
    });
</script>


{% endblock %}